---
title: "Results"
author: "Guy Taseski and Will Cornwell"
date: "September 26, 2016"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(lme4)
read_csv("mass_output.csv") %>%
  filter(!is.na(species)) -> mass_df
```
#RESULTS

##Trait Community Relationships

Strong relationships were identified for community trait mean values across a Hydrological gradient. Root Tissue Density (RTD) exhibited a significant difference across the hydrological gradient (F(1,465)= 36.352, P = 3.359e-09). Similarly, Root Dry Mass Content (RDMC) also exhibited a significant difference across the hydrological gradient (F(1,465)= 23.736, P = 1.517e-06). These results suggest that at a community level, species whose roots are less dense and have higher water contents will be filtered out from the community as it transitions into a drier environment. However out results do not support the notion that plants with high RTD and RDMC will be excluded from the wet end of the hydrological gradient (See figure 1 and 2) as a species which possessed both high RTD and RDMC was sampled from both the driest and wettest parts of the hydrological gradient suggesting that biological interactions or some other force may be prevent certain high RTD and RDMC species from expanding their niches. 



##TRAIT TRENDS ACROSS SPECIES

###Tissue Density across species

```{r, eval=TRUE, echo = FALSE}
group_by(mass_df,species) %>%
summarize(
          som.median=median(som),
          density.mean=mean(density,na.rm=TRUE),
          som.quant1=quantile(som,0.5)-quantile(som,0.1),
          som.quant2=quantile(som,0.9)-quantile(som,0.5),
          density.se=sd(density,na.rm=TRUE)/sqrt(sum(!is.na(density))),
          smc.median=median(smc),
          smc.quant1=quantile(smc,0.5)-quantile(smc,0.1),
          smc.quant2=quantile(smc,0.9)-quantile(smc,0.5)
          )->temp_TD    


ggplot(temp_TD,aes(x=som.median,y=density.mean,col=species))+
  geom_point()+
  geom_errorbarh(aes(xmin=som.median-som.quant1,xmax=som.median+som.quant2,y=density.mean))+
  geom_errorbar(aes(ymin=density.mean-density.se,ymax=density.mean+density.se))+
  theme_bw()+
  scale_x_log10(breaks=c(1:10))+ 
  theme(legend.text=element_text(size=7))->gg
ggplotly(gg)

#STATS

td_lm <- lm(mass_df$som ~ mass_df$density)
anova(td_lm)
summary(td_lm)
```

## RDMC across species

```{r, echo = FALSE}
group_by(mass_df,species) %>%
summarize(
          som.median=median(som),
          RDMC.mean=mean(RDMC,na.rm=TRUE),
          som.quant1=quantile(som,0.5)-quantile(som,0.1),
          som.quant2=quantile(som,0.9)-quantile(som,0.5),
          RDMC.se=sd(RDMC,na.rm=TRUE)/sqrt(sum(!is.na(RDMC))),
          smc.median=median(smc),
          smc.quant1=quantile(smc,0.5)-quantile(smc,0.1),
          smc.quant2=quantile(smc,0.9)-quantile(smc,0.5)
          )->temp_RDMC    


ggplot(temp_RDMC,aes(x=som.median,y=RDMC.mean,col=species))+
  geom_point()+
  geom_errorbarh(aes(xmin=som.median-som.quant1,xmax=som.median+som.quant2,y=RDMC.mean))+
  geom_errorbar(aes(ymin=RDMC.mean-RDMC.se,ymax=RDMC.mean+RDMC.se))+
  theme_bw()+
  scale_x_log10(breaks=c(1:10))+ 
  theme(legend.text=element_text(size=7))->gg
ggplotly(gg)

#STATS

RDMC_lm <- lm(mass_df$som ~ mass_df$RDMC)
anova(RDMC_lm)
summary(RDMC_lm)

```

## SRL across species

```{r, echo = FALSE}
group_by(mass_df,species) %>%
summarize(
          som.median=median(som),
          srl.mean=mean(srl,na.rm=TRUE),
          som.quant1=quantile(som,0.5)-quantile(som,0.1),
          som.quant2=quantile(som,0.9)-quantile(som,0.5),
          srl.se=sd(srl,na.rm=TRUE)/sqrt(sum(!is.na(srl))),
          smc.median=median(smc),
          smc.quant1=quantile(smc,0.5)-quantile(smc,0.1),
          smc.quant2=quantile(smc,0.9)-quantile(smc,0.5)
          )->temp_TD    


ggplot(temp_TD,aes(x=som.median,y=srl.mean,col=species))+
  geom_point()+
  geom_errorbarh(aes(xmin=som.median-som.quant1,xmax=som.median+som.quant2,y=srl.mean))+
  geom_errorbar(aes(ymin=srl.mean-srl.se,ymax=srl.mean+srl.se))+
  theme_bw()+
  scale_x_log10(breaks=c(1:10))+ 
  theme(legend.text=element_text(size=7))->gg
ggplotly(gg)

#STATS

srl_lm <- lm(mass_df$som ~ mass_df$srl)
anova(srl_lm)
```


# Trait Trends within species

##Tissue Density within species

```{r, echo = FALSE}
#Cleaning Data for analysis
TD_clean<-filter(mass_df,species%in%names(table(mass_df$species))[table(mass_df$species)>11])
#A plot
 ggplot(TD_clean,aes(x=som,y=density,col=species))+geom_smooth(method="lm",se=F)+scale_x_log10()
 #Mixed effect model TD
 mod <- lmer(density ~ log(som) + (1|species), data = TD_clean, REML=T)
 mod.0 <- lmer(density ~  (1|species), data = TD_clean, REML=T)
 anova(mod,mod.0)
  
```

##RDMC within species

```{r, echo = FALSE}
#Cleaning Data for analysis
RDMC_clean<-filter(mass_df,species%in%names(table(mass_df$species))[table(mass_df$species)>11])
#A plot
 ggplot(RDMC_clean,aes(x=som,y=RDMC,col=species))+geom_smooth(method="lm",se=F)+scale_x_log10()
 #Mixed effect model TD
 mod <- lmer(RDMC ~ log(som) + (1|species), data = RDMC_clean, REML=T)
 mod.0 <- lmer(RDMC ~  (1|species), data = RDMC_clean, REML=T)
 anova(mod,mod.0)
```

##SRL within species

```{r, }
#Cleaning Data for analysis
srl_clean<-filter(mass_df,species%in%names(table(mass_df$species))[table(mass_df$species)>11])
#A plot
 ggplot(srl_clean,aes(x=som,y=srl,col=species))+geom_smooth(method="lm",se=F)+scale_x_log10()
 #Mixed effect model TD
 mod <- lmer(srl ~ log(som) + (1|species), data = srl_clean, REML=T)
 mod.0 <- lmer(srl ~  (1|species), data = srl_clean, REML=T)
 anova(mod,mod.0)

```

# RDMC vs Tissue Density

```{r, echo = FALSE}
#Makes graphs
filter(mass_df, !RDMC > 1) -> Plot_TD_RDMC
hist(Plot_TD_RDMC$RDMC)
N<-ggplot(Plot_TD_RDMC, aes(x = RDMC, y = density, colour = species)) + geom_point() + geom_abline()
ggplotly(N)
#Summary_STATS
lm_RDMC_TD<-lm(Plot_TD_RDMC$RDMC ~ Plot_TD_RDMC$density)
summary(lm_RDMC_TD)
```


